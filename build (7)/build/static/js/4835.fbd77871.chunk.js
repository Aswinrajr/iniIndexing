"use strict";(self.webpackChunk_Minimall_Minimall_kit_react=self.webpackChunk_Minimall_Minimall_kit_react||[]).push([[4835],{52456:function(e,r,t){t.d(r,{Nd:function(){return p},Y:function(){return m},_$:function(){return Z},fR:function(){return h},mo:function(){return x},r$:function(){return w},wI:function(){return v}});var n=t(1413),s=t(74165),o=t(15861),i=t(90573),a=t(36797),u=t(36974),c="thesis",l=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var t,n,i,u=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>1&&void 0!==u[1]?u[1]:"thesis_files",n=(0,a.cF)(),i=r.map(function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var o,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,a.iH)(n,"".concat(t,"/").concat(r.name)),e.next=3,(0,a.KV)(o,r);case 3:return i=e.sent,e.abrupt("return",(0,a.Jt)(i.ref));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(i));case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),d=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.PL)((0,i.hJ)(u.ZP,c));case 2:return r=e.sent,t=r.size+1,e.abrupt("return","IJI".concat(t.toString().padStart(7,"0")));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=(new Date).getFullYear();return{volume:e-2023,year:e}},h=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var t,o,a,h,p,v,m,x;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d();case 3:if(t=e.sent,o=f(),a=o.volume,h=o.year,p={thesisId:t,title:r.title,collegeUniversity:r.collegeUniversity||"",author:r.author||"",volume:a,year:h},!(r.photoId&&r.photoId.length>0)){e.next=11;break}return e.next=9,l(r.photoId,"thesis_photos");case 9:v=e.sent,p.photoId=v;case 11:if(!(r.fullPdf&&r.fullPdf.length>0)){e.next=16;break}return e.next=14,l(r.fullPdf,"thesis_pdfs");case 14:m=e.sent,p.fullPdf=m;case 16:return e.next=18,(0,i.ET)((0,i.hJ)(u.ZP,c),p);case 18:return x=e.sent,console.log("Thesis document written with ID: ",x.id),e.abrupt("return",(0,n.Z)({id:x.id},p));case 23:throw e.prev=23,e.t0=e.catch(0),console.error("Error adding thesis: ",e.t0),new Error(e.t0.message);case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(r){return e.apply(this,arguments)}}(),p=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r,t){var n,o,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,i.JU)(u.ZP,c,r),!(t.photoId&&t.photoId.length>0)){e.next=7;break}return e.next=5,l(t.photoId,"thesis_photos");case 5:o=e.sent,t.photoId=o;case 7:if(!(t.fullPdf&&t.fullPdf.length>0)){e.next=12;break}return e.next=10,l(t.fullPdf,"thesis_pdfs");case 10:a=e.sent,t.fullPdf=a;case 12:return e.next=14,(0,i.r7)(n,t);case 14:console.log("Thesis updated with ID: ",r),e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(0),console.error("Error updating thesis: ",e.t0),new Error(e.t0.message);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r,t){return e.apply(this,arguments)}}(),v=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,i.JU)(u.ZP,c,r),e.next=4,(0,i.oe)(t);case 4:console.log("Thesis deleted with ID: ",r),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error deleting thesis: ",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r){return e.apply(this,arguments)}}(),m=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var r,t,o,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.PL)((0,i.hJ)(u.ZP,"thesis"));case 3:return r=e.sent,t=r.docs.map((function(e){return(0,n.Z)({id:e.id},e.data())})),o=t.reduce((function(e,r){var t=r.volume;return e[t]||(e[t]=[]),e[t].push(r),e}),{}),a=Object.keys(o).map((function(e){return{volume:e,theses:o[e]}})),e.abrupt("return",a);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error getting theses: ",e.t0),new Error(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var t,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,i.JU)(u.ZP,c,r),e.next=4,(0,i.QT)(t);case 4:if((o=e.sent).exists()){e.next=8;break}throw console.error("No such thesis with ID: ".concat(r)),new Error("No such document!");case 8:return e.abrupt("return",(0,n.Z)({id:o.id},o.data()));case 11:throw e.prev=11,e.t0=e.catch(0),console.error("Error getting thesis: ",e.t0),new Error(e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r){return e.apply(this,arguments)}}(),Z=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r){var t,o,a,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"undefined"!==typeof r&&null!==r){e.next=3;break}throw new Error("Volume is undefined or null");case 3:return console.log("Fetching theses for volume:",r),t=(0,i.hJ)(u.ZP,"thesis"),o=(0,i.IO)(t,(0,i.ar)("volume","==",r)),e.next=8,(0,i.PL)(o);case 8:if(!(a=e.sent).empty){e.next=12;break}throw console.error("No theses found for volume: ".concat(r)),new Error("No documents found!");case 12:return c=[],a.forEach((function(e){c.push((0,n.Z)({id:e.id},e.data()))})),e.abrupt("return",{volume:r,theses:c});case 17:throw e.prev=17,e.t0=e.catch(0),console.error("Error getting theses: ",e.t0),new Error(e.t0.message);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r){return e.apply(this,arguments)}}(),w=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(r,t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,i.JU)(u.ZP,c,r),e.next=4,(0,i.r7)(n,{UserStatus:t});case 4:console.log("User status updated to ".concat(t," for User ID: ").concat(r)),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error updating User status: ",e.t0),new Error(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}()},4835:function(e,r,t){t.d(r,{Z:function(){return P}});var n=t(93433),s=t(74165),o=t(15861),i=t(47313),a=t(58467),u=t(3463),c=t(62563),l=t(75627),d=t(32703),f=t(82937),h=t(92484),p=t(16157),v=t(34940),m=t(42669),x=t(62463),Z=t(50734),w=t(41034),g=t(52456),b=t(46417);function P(e){var r=e.isEdit,t=e.currentThesis,P=(0,a.s0)(),y=(0,w.Ds)().enqueueSnackbar,k=(0,a.UO)().id,j=u.Ry().shape({title:u.Z_().required("Thesis Title is required"),collegeUniversity:u.Z_().required("College/University is required"),author:u.Z_().required("Author is required"),photoId:u.IX().min(1,"At least one photo ID is required"),fullPdf:u.IX().min(1,"At least one full PDF is required")}),I=(0,i.useMemo)((function(){return{title:(null===t||void 0===t?void 0:t.title)||"",collegeUniversity:(null===t||void 0===t?void 0:t.collegeUniversity)||"",author:(null===t||void 0===t?void 0:t.author)||"",photoId:[],fullPdf:[]}}),[t]),E=(0,l.cI)({resolver:(0,c.X)(j),defaultValues:I}),U=E.reset,_=E.watch,C=E.setValue,T=E.handleSubmit,D=(E.formState.isSubmitting,_());(0,i.useEffect)((function(){console.log("useEffect is firing. ID:",k,"isEdit:",r);var e=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=13;break}return e.prev=1,e.next=4,(0,g.mo)(k);case 4:t=e.sent,console.log("Fetched Thesis:",t),t?(U({title:(null===t||void 0===t?void 0:t.title)||"",collegeUniversity:(null===t||void 0===t?void 0:t.collegeUniversity)||"",author:(null===t||void 0===t?void 0:t.author)||"",photoId:(null===t||void 0===t?void 0:t.photoId)||[],fullPdf:(null===t||void 0===t?void 0:t.fullPdf)||[]}),console.log("Form reset with thesis:",t)):(y("Thesis not found",{variant:"error"}),P("/dashboard/theses/list")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("Error fetching thesis:",e.t0),y("An error occurred while fetching thesis details",{variant:"error"});case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();e()}),[k,r,U,y,P]);var S=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!r){e.next=6;break}return e.next=4,(0,g.Nd)(k,t);case 4:e.next=8;break;case 6:return e.next=8,(0,g.fR)(t);case 8:U(),y(r?"Update success!":"Create success!"),P("/dashboard/theses/list"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error during submission:",e.t0),y("An error occurred. Please try again.",{variant:"error"});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(r){return e.apply(this,arguments)}}(),R=(0,i.useCallback)((function(e){var r=D.photoId||[],t=e.map((function(e){return Object.assign(e,{preview:URL.createObjectURL(e)})}));C("photoId",[].concat((0,n.Z)(r),(0,n.Z)(t)),{shouldValidate:!0})}),[C,D.photoId]),J=(0,i.useCallback)((function(e){var r=D.fullPdf||[],t=e.map((function(e){return Object.assign(e,{preview:URL.createObjectURL(e)})}));C("fullPdf",[].concat((0,n.Z)(r),(0,n.Z)(t)),{shouldValidate:!0})}),[C,D.fullPdf]);return(0,b.jsxs)(Z.ZP,{methods:E,onSubmit:T(S),children:[(0,b.jsx)(f.ZP,{container:!0,spacing:3,children:(0,b.jsx)(f.ZP,{item:!0,xs:12,md:12,children:(0,b.jsxs)(h.Z,{sx:{p:3},children:[(0,b.jsxs)(p.Z,{display:"flex",alignItems:"center",children:[(0,b.jsx)(v.Z,{style:{flexGrow:1}}),(0,b.jsx)(m.Z,{variant:"h4",style:{margin:"0 16px",whiteSpace:"nowrap"},children:"Thesis Submission"}),(0,b.jsx)(v.Z,{style:{flexGrow:1}})]}),(0,b.jsx)(x.Z,{spacing:3,style:{marginTop:"30px"},children:(0,b.jsxs)(f.ZP,{container:!0,spacing:2,children:[(0,b.jsx)(f.ZP,{item:!0,xs:12,sm:6,children:(0,b.jsx)(Z.au,{name:"title",label:"Thesis Title*",fullWidth:!0})}),(0,b.jsx)(f.ZP,{item:!0,xs:12,sm:6,children:(0,b.jsx)(Z.au,{name:"collegeUniversity",label:"College/University*",fullWidth:!0})}),(0,b.jsx)(f.ZP,{item:!0,xs:12,sm:6,children:(0,b.jsx)(Z.au,{name:"author",label:"Author*",fullWidth:!0})}),(0,b.jsxs)(f.ZP,{item:!0,xs:12,md:12,children:[(0,b.jsx)(m.Z,{variant:"title",style:{fontWeight:"bold"},children:"Photo ID"}),(0,b.jsx)(Z.rd,{multiple:!0,thumbnail:!0,name:"photoId",maxSize:3145728,accept:"image/*",onDrop:R})]}),(0,b.jsxs)(f.ZP,{item:!0,xs:12,md:12,children:[(0,b.jsx)(m.Z,{variant:"title",style:{fontWeight:"bold"},children:"Full PDF"}),(0,b.jsx)(Z.rd,{multiple:!0,thumbnail:!0,name:"fullPdf",maxSize:5242880,accept:"application/pdf",onDrop:J})]}),(0,b.jsx)("br",{}),(0,b.jsxs)(f.ZP,{container:!0,spacing:2,justifyContent:"flex-end",sx:{mt:2},children:[(0,b.jsx)(f.ZP,{item:!0,children:(0,b.jsx)(d.Z,{type:"submit",variant:"contained",size:"large",children:r?"Save Changes":"Create Thesis"})}),(0,b.jsx)(f.ZP,{item:!0,children:(0,b.jsx)(d.Z,{type:"button",variant:"outlined",size:"large",onClick:function(){return U()},children:"Reset"})})]})]})})]})})}),(0,b.jsx)("br",{})]})}},92484:function(e,r,t){t.d(r,{Z:function(){return x}});var n=t(87462),s=t(63366),o=t(47313),i=t(83061),a=t(21921),u=t(64164),c=t(11236),l=t(80654),d=t(77430),f=t(32298);function h(e){return(0,f.Z)("MuiCard",e)}(0,d.Z)("MuiCard",["root"]);var p=t(46417),v=["className","raised"],m=(0,u.ZP)(l.Z,{name:"MuiCard",slot:"Root",overridesResolver:function(e,r){return r.root}})((function(){return{overflow:"hidden"}})),x=o.forwardRef((function(e,r){var t=(0,c.Z)({props:e,name:"MuiCard"}),o=t.className,u=t.raised,l=void 0!==u&&u,d=(0,s.Z)(t,v),f=(0,n.Z)({},t,{raised:l}),x=function(e){var r=e.classes;return(0,a.Z)({root:["root"]},h,r)}(f);return(0,p.jsx)(m,(0,n.Z)({className:(0,i.Z)(x.root,o),elevation:l?8:void 0,ref:r,ownerState:f},d))}))}}]);